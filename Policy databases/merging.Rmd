---
title: "merging_datasets"
author: "Laura Menicacci"
date: "2022-11-25"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(countrycode)
library(readr)
```

## Loading datasets

```{r}
iea <- read_csv("policies_database_IEA_commasep.csv")
eea <- read_csv("eea.csv") # to be updated
cpd <- read_csv("cpd.csv")
unfccc <- read_csv("unfccc_final.csv")

```

# Prep for each of datasets

- filter for electricity sector
- filter for variables of interest: name of policy, policy description, years information, url to original policy
- add indicator database source column
```{r}
eea_prep <- eea %>% 
  filter(grepl(c("Energy Supply|Other Sectors"), `Sector(s) affected`)) %>% 
  select(Country, `Name of policy or measure`, Description, `Implementation period start`, `Implementation period finish`, `URL to main reference`) %>% 
  mutate(country_code = countrycode(Country, origin = "country.name", destination = "iso3c")) %>% 
  mutate(indicator_database_source = "EEA")

cpd_prep <- cpd %>% 
  select(Country, `Country ISO`, `Policy Title`, `Policy description`, `Date of decision`, `Start date of implementation`, `End date of implementation`,  `Source or references`) %>% 
  mutate(indicator_database_source = "Climate Policy Database")

iea_prep <- iea %>% 
  filter(grepl(c("Power, Heat and Utilities|Power generation|Electricity and heat generation|Combined heat and power"), Sectors)) %>% 
  select(Country, Year, Policy, Description, URL) %>% 
  mutate(country_code = countrycode(Country, origin = "country.name", destination = "iso3c")) %>%
  mutate(indicator_database_source = "IEA")
  # mutate("Country Code" = case_when(Country == "European Union" ~ "Country Code" == "EU")) # not working

unfccc_prep <- unfccc %>% 
  select(Country, `Country Code`, `Source NC#`, Year, `Policy Name`, `Policy Description`, Link) %>% 
  mutate(year_implementation = NA) %>% 
  mutate(year_decision = NA) %>% 
  mutate(year_end = NA) %>% 
  mutate(indicator_database_source = "UNFCCC National Communications")
  
```


 
# Merge 
```{r}

unfccc_cpd <- full_join(unfccc_prep, cpd_prep, by = c("Country", "Country Code" = "Country ISO", "Policy Name" = "Policy Title", "Policy Description" = "Policy description", "year_implementation" = "Start date of implementation", "year_decision" = "Date of decision","year_end" = "End date of implementation",  "Link" = "Source or references", "indicator_database_source" ))

unfccc_cpd_eea <- full_join(unfccc_cpd, eea_prep, by = c("Country", "Country Code" = "country_code", "Policy Name" = "Name of policy or measure", "Policy Description" = "Description", "year_implementation" = "Implementation period start", "year_end" = "Implementation period finish",  "Link" = "URL to main reference", "indicator_database_source"))

unfccc_cpd_eea_iea <- full_join(unfccc_cpd_eea, iea_prep, by = c("Country", "Country Code" = "country_code", "Policy Name" = "Policy", "Policy Description" = "Description", "Year", "Link" = "URL", "indicator_database_source"))

```

# Filter for all countries of interest are present
Australia, Austria, Belgium, Canada, Denmark, Finland, France, Germany, Greece, Ireland, Italy, Japan, Luxembourg, Netherlands, New Zealand, Portugal, Spain, Sweden, Switzerland, United Kingdom and the USA
```{r}
countries <- c("Australia", "Austria", "Belgium", "Canada", "Denmark", "Finland", "France", "Germany", "Greece", "Ireland", "Italy", "Japan", "Luxembourg", "Netherlands", "New Zealand", "Portugal", "Spain", "Sweden", "Switzerland", "United Kingdom", "United States of America")

unfccc_cpd_eea_iea %>% 
  filter(Country == c(countries))

```


# FILTER FOR JAPAN DUP

```{r}

```


# add Elina's code here
```{r}
jap <- unfccc_cpd_eea_iea %>% 
  filter(Country == "Japan")


```


 


```{r}
write.csv(unfccc_cpd_eea_iea,"C:\\Users\\laura\\OneDrive\\Documenti\\LAURA\\MCC\\Policy databases\\ceres_firstversion.csv")
```

